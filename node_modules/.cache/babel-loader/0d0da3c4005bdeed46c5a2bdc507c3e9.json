{"ast":null,"code":"import _slicedToArray from \"/Users/jacabe/Downloads/02-countdown-answer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\n\nvar _s = $RefreshSig$();\n\nimport { useState, useCallback, useEffect, useRef } from \"react\";\nvar SECOND = 1;\nvar MINUTE = SECOND * 60;\nvar HOUR = MINUTE * 60;\nvar DAY = HOUR * 24;\n\nvar digi = function digi(value) {\n  return value < 10 ? \"0\" + value : \"\" + value;\n};\n/**\n  * @param {number} endTime timestamp\n  * @returns {\n  *   onStart: ()=>void;\n  *   onStop: ()=>void;\n  *   value: string;  // DD:hh:mm:ss ,when expired, return 'timeup';\n  *   isActive: boolean;\n  * }\n */\n\n\nexport default function useCountdown(endTime) {\n  _s();\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      value = _useState2[0],\n      setValue = _useState2[1];\n\n  var _useState3 = useState(true),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isActive = _useState4[0],\n      setActive = _useState4[1];\n\n  useEffect(function () {\n    var timeId = -1;\n\n    if (isActive) {\n      var tick = function tick() {\n        var diffSec = Math.round((endTime - Date.now()) / 1000);\n\n        if (diffSec <= 0) {\n          setActive(false);\n          setValue(\"timeup\");\n          return;\n        }\n\n        var sec = diffSec % 60;\n        var min = ~~(diffSec / MINUTE % 60);\n        var hour = ~~(diffSec / HOUR % 24);\n        var day = ~~(diffSec / DAY);\n        setValue(\"\".concat(digi(day), \":\").concat(digi(hour), \":\").concat(digi(min), \":\").concat(digi(sec)));\n      };\n\n      timeId = window.setInterval(tick, 1000); //setInterval延遲了某段時間做某事()，並且一直重複執行\n\n      tick();\n    }\n\n    return function () {\n      if (timeId !== -1) {\n        window.clearInterval(timeId);\n      }\n    };\n  }, [isActive]); // eslint-disable-line\n\n  var onStart = useCallback(function () {\n    setActive(true);\n  }, []);\n  var onStop = useCallback(function () {\n    setActive(false);\n  }, []);\n  return {\n    onStart: onStart,\n    onStop: onStop,\n    value: value,\n    isActive: isActive\n  };\n}\n\n_s(useCountdown, \"YYzPqFSbytjFiEOGhYcHYwGXqsY=\");","map":{"version":3,"names":["useState","useCallback","useEffect","useRef","SECOND","MINUTE","HOUR","DAY","digi","value","useCountdown","endTime","setValue","isActive","setActive","timeId","tick","diffSec","Math","round","Date","now","sec","min","hour","day","window","setInterval","clearInterval","onStart","onStop"],"sources":["/Users/jacabe/Downloads/02-countdown-answer/src/hooks/useCountdown.js"],"sourcesContent":["import {\n  useState,\n  useCallback,\n  useEffect,\n  useRef\n} from \"react\";\n\nconst SECOND = 1;\nconst MINUTE = SECOND * 60;\nconst HOUR = MINUTE * 60;\nconst DAY = HOUR * 24;\n\nconst digi = (value) => value < 10 ? \"0\" + value : \"\" + value;\n\n/**\n  * @param {number} endTime timestamp\n  * @returns {\n  *   onStart: ()=>void;\n  *   onStop: ()=>void;\n  *   value: string;  // DD:hh:mm:ss ,when expired, return 'timeup';\n  *   isActive: boolean;\n  * }\n */\nexport default function useCountdown(endTime) {\n  const [value, setValue] = useState('');\n  const [isActive, setActive] = useState(true);\n\n  useEffect(() => {\n    let timeId = -1;\n    if(isActive) {\n      const tick = () => {\n        const diffSec = Math.round((endTime - Date.now()) / 1000);\n        if (diffSec <= 0) {\n          setActive(false);\n          setValue(\"timeup\");\n          return;\n        }\n        const sec = diffSec % 60;\n        const min = ~~(diffSec / MINUTE % 60);\n        const hour = ~~(diffSec / HOUR % 24);\n        const day = ~~(diffSec / DAY);\n        setValue(`${digi(day)}:${digi(hour)}:${digi(min)}:${digi(sec)}`);\n      };\n      timeId = window.setInterval(tick, 1000); //setInterval延遲了某段時間做某事()，並且一直重複執行\n      tick();\n    }\n    return () => {\n      if(timeId !== -1) {\n        window.clearInterval(timeId);\n      }\n    }\n  }, [isActive]); // eslint-disable-line\n\n  const onStart = useCallback(() => {\n    setActive(true);\n  }, []);\n\n  const onStop = useCallback(() => {\n    setActive(false);\n  }, []);\n\n  return {\n    onStart,\n    onStop,\n    value,\n    isActive\n  };\n}\n"],"mappings":";;;;AAAA,SACEA,QADF,EAEEC,WAFF,EAGEC,SAHF,EAIEC,MAJF,QAKO,OALP;AAOA,IAAMC,MAAM,GAAG,CAAf;AACA,IAAMC,MAAM,GAAGD,MAAM,GAAG,EAAxB;AACA,IAAME,IAAI,GAAGD,MAAM,GAAG,EAAtB;AACA,IAAME,GAAG,GAAGD,IAAI,GAAG,EAAnB;;AAEA,IAAME,IAAI,GAAG,SAAPA,IAAO,CAACC,KAAD;EAAA,OAAWA,KAAK,GAAG,EAAR,GAAa,MAAMA,KAAnB,GAA2B,KAAKA,KAA3C;AAAA,CAAb;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,eAAe,SAASC,YAAT,CAAsBC,OAAtB,EAA+B;EAAA;;EAC5C,gBAA0BX,QAAQ,CAAC,EAAD,CAAlC;EAAA;EAAA,IAAOS,KAAP;EAAA,IAAcG,QAAd;;EACA,iBAA8BZ,QAAQ,CAAC,IAAD,CAAtC;EAAA;EAAA,IAAOa,QAAP;EAAA,IAAiBC,SAAjB;;EAEAZ,SAAS,CAAC,YAAM;IACd,IAAIa,MAAM,GAAG,CAAC,CAAd;;IACA,IAAGF,QAAH,EAAa;MACX,IAAMG,IAAI,GAAG,SAAPA,IAAO,GAAM;QACjB,IAAMC,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAW,CAACR,OAAO,GAAGS,IAAI,CAACC,GAAL,EAAX,IAAyB,IAApC,CAAhB;;QACA,IAAIJ,OAAO,IAAI,CAAf,EAAkB;UAChBH,SAAS,CAAC,KAAD,CAAT;UACAF,QAAQ,CAAC,QAAD,CAAR;UACA;QACD;;QACD,IAAMU,GAAG,GAAGL,OAAO,GAAG,EAAtB;QACA,IAAMM,GAAG,GAAG,CAAC,EAAEN,OAAO,GAAGZ,MAAV,GAAmB,EAArB,CAAb;QACA,IAAMmB,IAAI,GAAG,CAAC,EAAEP,OAAO,GAAGX,IAAV,GAAiB,EAAnB,CAAd;QACA,IAAMmB,GAAG,GAAG,CAAC,EAAER,OAAO,GAAGV,GAAZ,CAAb;QACAK,QAAQ,WAAIJ,IAAI,CAACiB,GAAD,CAAR,cAAiBjB,IAAI,CAACgB,IAAD,CAArB,cAA+BhB,IAAI,CAACe,GAAD,CAAnC,cAA4Cf,IAAI,CAACc,GAAD,CAAhD,EAAR;MACD,CAZD;;MAaAP,MAAM,GAAGW,MAAM,CAACC,WAAP,CAAmBX,IAAnB,EAAyB,IAAzB,CAAT,CAdW,CAc8B;;MACzCA,IAAI;IACL;;IACD,OAAO,YAAM;MACX,IAAGD,MAAM,KAAK,CAAC,CAAf,EAAkB;QAChBW,MAAM,CAACE,aAAP,CAAqBb,MAArB;MACD;IACF,CAJD;EAKD,CAxBQ,EAwBN,CAACF,QAAD,CAxBM,CAAT,CAJ4C,CA4B5B;;EAEhB,IAAMgB,OAAO,GAAG5B,WAAW,CAAC,YAAM;IAChCa,SAAS,CAAC,IAAD,CAAT;EACD,CAF0B,EAExB,EAFwB,CAA3B;EAIA,IAAMgB,MAAM,GAAG7B,WAAW,CAAC,YAAM;IAC/Ba,SAAS,CAAC,KAAD,CAAT;EACD,CAFyB,EAEvB,EAFuB,CAA1B;EAIA,OAAO;IACLe,OAAO,EAAPA,OADK;IAELC,MAAM,EAANA,MAFK;IAGLrB,KAAK,EAALA,KAHK;IAILI,QAAQ,EAARA;EAJK,CAAP;AAMD;;GA5CuBH,Y"},"metadata":{},"sourceType":"module"}